# ___  ___  ___ _____  ______  _______  _____   ________  ___  ________  ________
#|\  \|\  \|\  \|\   _  \ |\   __  \|\  \ |\  \|\   ___ \|\  \|\   __  \|\   ___  \
#\ \  \\\  \\\  \ \  \|\  \ \  \|\  \ \  \ \  \ \  \_|\ \ \  \ \  \|\ /\ \  \\ \  \
# \ \   __  \\  \ \  \\\  \ \   ____\ \  \ \  \ \  \ \\ \ \  \ \   __  \ \  \\ \  \
#  \ \  \ \  \\  \ \  \\\  \ \  \___|\ \  \_\  \ \  \_\\ \ \  \ \  \|\  \ \  \\ \  \
#   \ \__\ \__\\__\ \_______\ \__\     \ \_______\ \_______\ \__\ \_______\ \__\\ \__\
#    \|__|\|__|\|__|\|_______|\|__|      \|_______|\|_______|\|__|\|_______|\|__| \|__|
#
# HYPRLAND CONFIGURATION - OCCULT BLOOD RED THEME
# Migrated from i3 with enhanced Wayland features
# ==========================================

# ##################
# MONITOR SETUP
# ##################

# Primary monitor configuration
monitor = HDMI-A-1, 1920x1080@144, 0x0, 1
monitor = , preferred, auto, 1

# ##################
# AUTOSTART
# ##################

# Essential services
exec-once = waybar
exec-once = dunst
exec-once = swww init
exec-once = swww img ~/Pictures/wp15589380.png
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# Pywal integration
exec-once = wal -R
exec-once = ~/.config/hypr/scripts/update-colors.sh

# Background services  
exec-once = udiskie --automount --notify --tray
exec-once = nm-applet --indicator

# Setup scratchpad applications
exec-once = ~/.config/hypr/scripts/setup-scratchpads.sh

# ##################
# ENVIRONMENT VARIABLES
# ##################

env = XCURSOR_SIZE,24
env = QT_QPA_PLATFORMTHEME,qt5ct
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland
env = GDK_BACKEND,wayland,x11
env = QT_QPA_PLATFORM,wayland;xcb
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland

# ##################
# LOOK AND FEEL
# ##################

# Pywal color scheme (will be overridden by wal-reload script)
source = ~/.cache/wal/colors-hyprland.conf

general {
    gaps_in = 3
    gaps_out = 1
    border_size = 2

    # Pywal colors - fallback
    col.active_border = rgba(c5c8c6ff) rgba(1d1f21ff) 45deg
    col.inactive_border = rgba(373b41ff)

    layout = dwindle
    allow_tearing = false
    resize_on_border = true
    extend_border_grab_area = 15
}

decoration {
    rounding = 8

    blur {
        enabled = true
        size = 8
        passes = 2
        new_optimizations = true
        xray = true
        ignore_opacity = false
    }

    drop_shadow = true
    shadow_range = 18
    shadow_render_power = 2
    shadow_offset = -12, -12
    col.shadow = rgba(00000099)
    
    active_opacity = 1.0
    inactive_opacity = 0.95
    fullscreen_opacity = 1.0
    
    dim_inactive = false
    dim_strength = 0.1
}

animations {
    enabled = true
    
    bezier = myBezier, 0.05, 0.9, 0.1, 1.05
    bezier = overshot, 0.13, 0.99, 0.29, 1.1
    
    animation = windows, 1, 4, myBezier
    animation = windowsOut, 1, 4, default, popin 80%
    animation = border, 1, 8, default
    animation = borderangle, 1, 8, default
    animation = fade, 1, 4, default
    animation = workspaces, 1, 4, overshot, slidevert
}

dwindle {
    pseudotile = true
    preserve_split = true
    smart_split = false
    smart_resizing = true
}

master {
    new_is_master = true
    mfact = 0.5
}

misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
    disable_splash_rendering = true
    mouse_move_enables_dpms = true
    key_press_enables_dpms = true
    animate_manual_resizes = true
    animate_mouse_windowdragging = true
    enable_swallow = true
    swallow_regex = ^(kitty)$
    focus_on_activate = true
    new_window_takes_over_fullscreen = 2
}

# ##################
# INPUT CONFIGURATION
# ##################

input {
    kb_layout = us
    kb_variant =
    kb_model =
    kb_options =
    kb_rules =
    
    follow_mouse = 1
    mouse_refocus = false
    
    touchpad {
        natural_scroll = false
        disable_while_typing = true
        tap-to-click = true
        drag_lock = false
    }
    
    sensitivity = 0 # -1.0 - 1.0, 0 means no modification.
}

gestures {
    workspace_swipe = true
    workspace_swipe_fingers = 3
    workspace_swipe_distance = 300
    workspace_swipe_invert = true
    workspace_swipe_min_speed_to_force = 30
    workspace_swipe_cancel_ratio = 0.5
    workspace_swipe_create_new = true
    workspace_swipe_forever = true
}

# ##################
# KEYBINDINGS
# ##################

# Set mod key
$mainMod = SUPER

# Window management
bind = $mainMod, Return, exec, kitty
bind = $mainMod SHIFT, Q, killactive,
bind = $mainMod SHIFT, E, exit,
bind = $mainMod, F, fullscreen, 0
bind = $mainMod SHIFT, F, fullscreen, 1
bind = $mainMod SHIFT, Space, togglefloating,
bind = $mainMod, P, pseudo, # dwindle
bind = $mainMod, J, togglesplit, # dwindle

# Focus movement (vim-like)
bind = $mainMod, H, movefocus, l
bind = $mainMod, L, movefocus, r
bind = $mainMod, K, movefocus, u
bind = $mainMod, J, movefocus, d

# Focus movement (arrow keys)
bind = $mainMod, left, movefocus, l
bind = $mainMod, right, movefocus, r
bind = $mainMod, up, movefocus, u
bind = $mainMod, down, movefocus, d

# Window movement (vim-like)
bind = $mainMod SHIFT, H, movewindow, l
bind = $mainMod SHIFT, L, movewindow, r
bind = $mainMod SHIFT, K, movewindow, u
bind = $mainMod SHIFT, J, movewindow, d

# Window movement (arrow keys)
bind = $mainMod SHIFT, left, movewindow, l
bind = $mainMod SHIFT, right, movewindow, r
bind = $mainMod SHIFT, up, movewindow, u
bind = $mainMod SHIFT, down, movewindow, d

# Resize windows
bind = $mainMod CTRL, H, resizeactive, -50 0
bind = $mainMod CTRL, L, resizeactive, 50 0
bind = $mainMod CTRL, K, resizeactive, 0 -50
bind = $mainMod CTRL, J, resizeactive, 0 50

# Resize windows (arrow keys)
bind = $mainMod CTRL, left, resizeactive, -50 0
bind = $mainMod CTRL, right, resizeactive, 50 0
bind = $mainMod CTRL, up, resizeactive, 0 -50
bind = $mainMod CTRL, down, resizeactive, 0 50

# Layout controls
bind = $mainMod, S, exec, hyprctl keyword general:layout "master"
bind = $mainMod, W, exec, hyprctl keyword general:layout "dwindle"
bind = $mainMod, E, layoutmsg, togglesplit

# Split modes
bind = $mainMod, B, layoutmsg, preselect l
bind = $mainMod, V, layoutmsg, preselect d

# Application launchers
bind = $mainMod, D, exec, rofi -show drun -theme ~/.config/hypr/rofi-hyprland.rasi
bind = $mainMod SHIFT, D, exec, rofi -show run -theme ~/.config/hypr/rofi-hyprland.rasi
bind = $mainMod, Space, exec, rofi -show drun -theme ~/.config/hypr/rofi-hyprland.rasi

# System utilities
bind = $mainMod SHIFT, C, exec, cliphist list | rofi -dmenu -theme ~/.config/hypr/rofi-hyprland.rasi | cliphist decode | wl-copy
bind = $mainMod, T, togglespecialworkspace, translate
bind = $mainMod, C, togglespecialworkspace, calendar

# Media controls
bind = , XF86AudioPlay, exec, playerctl play-pause
bind = , XF86AudioNext, exec, playerctl next
bind = , XF86AudioPrev, exec, playerctl previous
bind = , XF86AudioStop, exec, playerctl stop

# Volume controls
binde = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+ && notify-send "Volume" "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
binde = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%- && notify-send "Volume" "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
bind = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle && notify-send "Volume" "Toggled"

# Keyboard volume controls
binde = $mainMod SHIFT, equal, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
binde = $mainMod SHIFT, minus, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-

# Screenshot utilities
bind = , Print, exec, grim -g "$(slurp)" - | wl-copy && notify-send "Screenshot" "Selection copied to clipboard"
bind = $mainMod, Print, exec, grim - | wl-copy && notify-send "Screenshot" "Full screen copied to clipboard"
bind = SHIFT, Print, exec, grim -g "$(slurp)" ~/Pictures/screenshot-$(date +%Y%m%d_%H%M%S).png && notify-send "Screenshot" "Selection saved to Pictures"
bind = $mainMod SHIFT, Print, exec, grim ~/Pictures/screenshot-$(date +%Y%m%d_%H%M%S).png && notify-send "Screenshot" "Full screen saved to Pictures"

# Theme controls
bind = $mainMod SHIFT, W, exec, ~/.config/hypr/scripts/random-wallpaper.sh
bind = $mainMod SHIFT, T, exec, ~/.config/hypr/scripts/theme-selector.sh
bind = $mainMod SHIFT, R, exec, hyprctl reload

# Power menu
bind = $mainMod SHIFT, P, exec, ~/.config/hypr/scripts/power-menu.sh

# ##################
# WORKSPACE CONFIGURATION
# ##################

# OCCULT WORKSPACES - Preserving your i3 workspace names
workspace = 1, name:1:Main, monitor:HDMI-A-1
workspace = 2, name:2:IDE, monitor:HDMI-A-1  
workspace = 3, name:3:Hell, monitor:HDMI-A-1
workspace = 4, name:4:Satan, monitor:HDMI-A-1
workspace = 5, name:5:Void, monitor:HDMI-A-1
workspace = 6, name:6:Curse, monitor:HDMI-A-1
workspace = 7, name:7:Doom, monitor:HDMI-A-1
workspace = 8, name:8:Music, monitor:HDMI-A-1
workspace = 9, name:9:Discord, monitor:HDMI-A-1

# Switch workspaces
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move active window to workspace
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Quick workspace access (preserving your i3 shortcuts)
bind = $mainMod CTRL, B, workspace, 1  # Browser/Main
bind = $mainMod CTRL, P, workspace, 2  # Programming/IDE
bind = $mainMod CTRL, M, workspace, 8  # Music
bind = $mainMod CTRL, D, workspace, 9  # Discord

# Quick move to workspaces
bind = $mainMod CTRL SHIFT, B, movetoworkspace, 1  # Browser/Main
bind = $mainMod CTRL SHIFT, P, movetoworkspace, 2  # Programming/IDE
bind = $mainMod CTRL SHIFT, M, movetoworkspace, 8  # Music
bind = $mainMod CTRL SHIFT, D, movetoworkspace, 9  # Discord

# Special workspaces (scratchpads)
bind = $mainMod, grave, togglespecialworkspace, magic
bind = $mainMod SHIFT, grave, movetoworkspace, special:magic

# Mouse bindings
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# ##################
# WINDOW RULES
# ##################

# Floating windows
windowrule = float, ^(rofi)$
windowrule = float, ^(pavucontrol)$
windowrule = float, ^(nm-connection-editor)$
windowrule = float, ^(firefox)$ title:(Picture-in-Picture)
windowrule = float, ^(org.gnome.Calculator)$
windowrule = float, ^(org.gnome.Nautilus)$ title:(Properties)
windowrule = float, ^(file_progress)$
windowrule = float, ^(confirm)$
windowrule = float, ^(dialog)$
windowrule = float, ^(download)$
windowrule = float, ^(notification)$
windowrule = float, ^(error)$
windowrule = float, ^(splash)$
windowrule = float, ^(confirmreset)$
windowrule = float, title:^(Open File)$
windowrule = float, title:^(branchdialog)$
windowrule = float, title:^(Confirm to replace files)$
windowrule = float, title:^(File Operation Progress)$

# Opacity rules
windowrule = opacity 0.95 0.85, ^(kitty)$
windowrule = opacity 1.0 1.0, ^(firefox)$
windowrule = opacity 1.0 1.0, ^(discord)$
windowrule = opacity 1.0 1.0, ^(code)$

# Workspace assignments (preserving your i3 assignments)
windowrule = workspace 1, ^(firefox)$
windowrule = workspace 1, ^(Firefox)$
windowrule = workspace 1, ^(google-chrome)$
windowrule = workspace 1, ^(chromium)$

windowrule = workspace 2, ^(code)$
windowrule = workspace 2, ^(Code)$
windowrule = workspace 2, ^(cursor)$
windowrule = workspace 2, ^(Cursor)$
windowrule = workspace 2, ^(neovim)$

windowrule = workspace 8, ^(spotify)$
windowrule = workspace 8, ^(Spotify)$
windowrule = workspace 8, ^(rhythmbox)$
windowrule = workspace 8, ^(clementine)$
windowrule = workspace 8, ^(vlc)$

windowrule = workspace 9, ^(discord)$
windowrule = workspace 9, ^(Discord)$
windowrule = workspace 9, ^(vesktop)$

# Special workspace rules (scratchpads)
windowrule = workspace special:translate, title:^(translate)$
windowrule = workspace special:calendar, title:^(calendar)$

# Size and position rules
windowrule = size 800 600, ^(pavucontrol)$
windowrule = center, ^(pavucontrol)$

# Focus rules
windowrule = immediate, ^(rofi)$

# ##################
# LAYER RULES
# ##################

# Waybar
layerrule = blur, waybar
layerrule = ignorealpha 0.3, waybar

# Rofi
layerrule = blur, rofi
layerrule = ignorealpha 0.1, rofi

# Notifications
layerrule = blur, notifications
layerrule = ignorealpha 0.3, notifications

# ##################
# PLUGIN CONFIGURATION
# ##################

# Hyprexpo (if installed)
# plugin = /usr/lib/hyprexpo.so
# bind = $mainMod, grave, hyprexpo:expo, toggle

# ##################
# DEBUGGING
# ##################

# Uncomment for debugging
# debug {
#     enable_stdout_logs = true
#     disable_logs = false
# }
